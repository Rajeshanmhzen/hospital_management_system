generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/master-client"
}

datasource db {
  provider = "postgresql"
  url      = env("MASTER_DATABASE_URL")
}

model superAdmin {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tenant {
  id            String        @id @default(uuid())
  name          String
  subdomain     String        @unique
  ownerName     String
  ownerEmail    String
  ownerPhone    String?
  dbUrl         String
  logo          String?
  status        TenantStatus  @default(PENDING)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  subscriptions Subscription?

  @@map("tenants")
}

model PricingPlan {
  id            String         @id @default(uuid())
  name          String         @unique
  description   String
  monthlyPrice  Decimal        @db.Decimal(10, 2)
  yearlyPrice   Decimal        @db.Decimal(10, 2)
  maxUsers      Int
  maxPatients   Int
  features      Json
  isActive      Boolean        @default(true)
  isPublic      Boolean        @default(true)
  displayOrder  Int            @default(0)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  subscriptions Subscription[]

  @@map("pricing_plans")
}

model Subscription {
  id           String             @id @default(uuid())
  tenantId     String             @unique
  planId       String
  planName     String
  planPrice    Decimal            @db.Decimal(10, 2)
  billingCycle String
  maxUsers     Int
  maxPatients  Int
  features     Json
  status       SubscriptionStatus @default(ACTIVE)
  startDate    DateTime
  endDate      DateTime
  autoRenew    Boolean            @default(true)
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
  payments     Payment[]
  plan         PricingPlan        @relation(fields: [planId], references: [id])
  tenant       Tenant             @relation(fields: [tenantId], references: [id])

  @@index([tenantId])
  @@index([status])
  @@map("subscriptions")
}

model Payment {
  id             String        @id @default(uuid())
  subscriptionId String
  amount         Decimal       @db.Decimal(10, 2)
  currency       String        @default("USD")
  status         PaymentStatus @default(PENDING)
  transactionId  String?
  paidAt         DateTime?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  subscription   Subscription  @relation(fields: [subscriptionId], references: [id])

  @@map("payments")
}

enum TenantStatus {
  PENDING
  ACTIVE
  INACTIVE
  SUSPENDED
}

enum SubscriptionStatus {
  ACTIVE
  INACTIVE
  CANCELLED
  EXPIRED
  TRIAL
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}
